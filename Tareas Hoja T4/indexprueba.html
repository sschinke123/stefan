<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formular mit Validierungen</title>
    <style>
      /* Einfache Stile für das Formular */
      .form-container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
      }

      .form-line {
        margin-bottom: 10px;
      }

      textarea {
        width: 100%;
        margin-top: 10px;
      }
    </style>
  </head>

  <body>
    <div class="form-container">
      <h2>Registrierungsformular</h2>
      <form id="formulario">
        <!-- Zeile 1: Benutzername -->
        <div class="form-line">
          <label for="inputNombre">Benutzername:</label>
          <input type="text" id="inputNombre" name="inputNombre" required />
        </div>

        <!-- Zeile 2: Telefon -->
        <div class="form-line">
          <label for="inputTelef">Telefonnummer:</label>
          <input type="tel" id="inputTelef" name="inputTelef" required />
        </div>

        <!-- Zeile 3: Geburtsdatum -->
        <div class="form-line">
          <label for="inputDia">Geburtstag:</label>
          <input
            type="number"
            id="inputDia"
            name="inputDia"
            min="1"
            max="31"
            required
          />
          <input
            type="number"
            id="inputMes"
            name="inputMes"
            min="1"
            max="12"
            required
          />
          <input
            type="number"
            id="inputAno"
            name="inputAno"
            min="1900"
            max="2100"
            required
          />
        </div>

        <!-- Zeile 4: E-Mail -->
        <div class="form-line">
          <label for="inputEmail">E-Mail:</label>
          <input type="email" id="inputEmail" name="inputEmail" required />
        </div>

        <!-- Zeile 5: DNI -->
        <div class="form-line">
          <label for="inputDNI">DNI:</label>
          <input type="text" id="inputDNI" name="inputDNI" required />
        </div>

        <!-- Zeile 6: Checkbox für die Bedingungen -->
        <div class="form-line">
          <label for="inputConditions">
            <input
              type="checkbox"
              id="inputConditions"
              name="inputConditions"
            />
            Ich akzeptiere die Bedingungen
          </label>
        </div>

        <!-- Zeile 7: Buttons -->
        <div class="form-line">
          <button type="button" onclick="registrar()">Registrieren</button>
          <button type="button" onclick="limpiarFormulario()">
            Formular zurücksetzen
          </button>
          <button type="button" onclick="guardarDatos()">
            Daten speichern
          </button>
          <button type="button" onclick="recuperarDatos()">
            Daten wiederherstellen
          </button>
        </div>
      </form>

      <!-- Textarea für Feedback -->
      <textarea
        id="output"
        placeholder="Informationen des Formulars"
        rows="5"
        cols="50"
      ></textarea>
    </div>

    <script>
      // Funktion zum Überprüfen und Anzeigen der Eingabewerte und ihrer Gültigkeit
      const validateInput = () => {
        const nombre = document.getElementById("inputNombre");
        const telefono = document.getElementById("inputTelef");
        const dia = document.getElementById("inputDia");
        const mes = document.getElementById("inputMes");
        const ano = document.getElementById("inputAno");
        const email = document.getElementById("inputEmail");
        const dni = document.getElementById("inputDNI");

        let valid = true;
        let output = "";

        // Benutzername validieren: muss zwischen 3 und 20 Zeichen lang sein und darf nicht mit einer Zahl beginnen
        if (!/^[A-Za-z][A-Za-z0-9]{2,19}$/.test(nombre.value)) {
          output +=
            "Benutzername ist ungültig. Muss 3-20 Zeichen lang sein und darf nicht mit einer Zahl beginnen.\n";
          valid = false;
        }

        // Telefonnummer validieren (muss eine gültige Telefonnummer sein)
        if (!/^\+?\d{10,15}$/.test(telefono.value)) {
          output +=
            "Telefonnummer ist ungültig. Bitte geben Sie eine gültige Telefonnummer ein.\n";
          valid = false;
        }

        // Geburtsdatum validieren: Überprüfen, ob die Person über 18 Jahre alt ist
        const birthDate = new Date(ano.value, mes.value - 1, dia.value);
        const age = new Date().getFullYear() - birthDate.getFullYear();
        if (age < 18 || isNaN(birthDate.getTime())) {
          output +=
            "Das Geburtsdatum ist ungültig. Sie müssen mindestens 18 Jahre alt sein.\n";
          valid = false;
        }

        // E-Mail validieren
        if (!/\S+@\S+\.\S+/.test(email.value)) {
          output +=
            "E-Mail ist ungültig. Bitte geben Sie eine gültige E-Mail-Adresse ein.\n";
          valid = false;
        }

        // DNI validieren
        const pdni = /^[XYZ]?\d{5,8}[A-Z]{1}$/;
        if (!pdni.test(dni.value)) {
          output += "DNI ist ungültig. Bitte geben Sie eine gültige DNI ein.\n";
          valid = false;
        }

        // Anzeige der Fehler im Textbereich
        document.getElementById("output").value = output;

        // Wenn alle Eingaben gültig sind, wird das Formular abgesendet, andernfalls wird es blockiert
        return valid;
      };

      // Funktion zum Registrieren des Benutzers
      const registrar = () => {
        if (
          document.getElementById("inputConditions").checked &&
          validateInput()
        ) {
          alert("Formular erfolgreich eingereicht!");
        } else {
          alert(
            "Bitte akzeptieren Sie die Bedingungen und stellen Sie sicher, dass alle Eingaben korrekt sind."
          );
        }
      };

      // Funktion zum Speichern der Eingabedaten in Cookies
      const guardarDatos = () => {
        document
          .querySelectorAll(
            "input[type='text'], input[type='email'], input[type='tel'], input[type='number']"
          )
          .forEach((input) => {
            document.cookie = `${input.name}=${input.value}; path=/;`;
          });
      };

      // Funktion zum Abrufen und Setzen der Eingabedaten aus den Cookies
      const recuperarDatos = () => {
        document
          .querySelectorAll(
            "input[type='text'], input[type='email'], input[type='tel'], input[type='number']"
          )
          .forEach((input) => {
            const cookies = document.cookie.split(";");
            cookies.forEach((cookie) => {
              const [name, value] = cookie.trim().split("=");
              if (name === input.name) {
                input.value = decodeURIComponent(value);
              }
            });
          });
      };

      // Funktion zum Zurücksetzen des Formulars
      const limpiarFormulario = () => {
        document.getElementById("formulario").reset();
        document.getElementById("output").value = ""; // Leeren des Ausgabebereichs
      };
    </script>
  </body>
</html>
